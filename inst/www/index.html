<!DOCTYPE html>
<html lang="en">
<head>
<title>A</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<!-- ocpu library -->
<script src="opencpu/jquery-1.10.2.min.js"> </script>
<script src="opencpu/opencpu-0.4.js"> </script>

<!-- some optional styling stuff -->
<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="jqueryui/css/ui-lightness/jquery-ui-1.10.3.custom.css" rel="stylesheet" media="screen">

<script src="bootstrap/js/bootstrap.js"> </script>
<script src="jqueryui/jquery-ui-1.10.3.custom.js"> </script>

<script>
    //init this script when the page has loaded
    $(document).ready(function(){
      $("#submitbutton").on("click", function(){

        //arguments
        var myheader = $("#header").val() == "true";
        var myfile = $("#csvfile")[0].files[0];
        
        if(!myfile){
          alert("No file selected.");
          return;
        }

        //disable the button during upload
        $("#submitbutton").attr("disabled", "disabled");

        //perform the request
        var req = ocpu.call("readcsvnew", {
          file : myfile,
          header : myheader
        }, function(session){
          $("#printlink").attr("href", session.getLoc() + "R/.val/print")
          $("#rdalink").attr("href", session.getLoc() + "R/.val/rda")
          $("#csvlink").attr("href", session.getLoc() + "R/.val/csv")
          $("#tablink").attr("href", session.getLoc() + "R/.val/tab")
          $("#jsonlink").attr("href", session.getLoc() + "R/.val/json")
          $("#mdlink").attr("href", session.getLoc() + "R/.val/md")
        });
        
        //if R returns an error, alert the error message
        req.fail(function(){
          alert("Server error: " + req.responseText);
        });
        
        //after request complete, re-enable the button 
        req.always(function(){
          $("#submitbutton").removeAttr("disabled")
        });        
      });       
    });
    </script>
	

<script> 
$(function(){

  //optional, requires jquery-ui.
  $("#plotdiv").resizable()
  
  //button handler
  $("#plotbutton").on("click", function(e){
    e.preventDefault();
    $("#plotbutton").attr("disabled", "disabled")
    var req = $("#plotdiv").rplot("plotcars", {
      }).always(function(){
      $("#plotbutton").removeAttr("disabled");
    }).fail(function(){
      alert("HTTP error " + req.status + ": " + req.responseText);
    });
  });
  
  //plot the default values on page load
  $("#plotbutton").trigger("click")
});
</script>
<style>

#plotdiv {
  width: 100%;
  height: 400px;
  border: 1px solid #e3e3e3;
  border-radius: 4px;
}

#type {
  width: 164px;
}

#plotbutton{
  width: 120px;
  margin-left: 20px;
}

</style>
</head>

<body>
  <div class="container">

    <div class="page-header">
      <h1>A</h1>
    </div>
    
    <div class="row">
      <div class="span3">

        <form class="well" id="paramform">
          <fieldset>
            <input class="input-medium" id="choosefile" type="file" ></input>
			
			<br />
			<button id="submitbutton" type="button">Upload CSV file!</button>
			<br>
            
			<br />
			<a target="_blank" id="csvlink">csv</a></li>
      		<br />
            
			<br />
            
            <button class="btn btn-small btn-primary" id="plotbutton"><i class="icon-ok icon-white"></i> Plot series</button>
          </fieldset>
        </form>
      </div>
      
      <div class="span9">
        <div id="plotdiv"></div>
      </div>
    </div>
  
  </div>
</body>
</html>
